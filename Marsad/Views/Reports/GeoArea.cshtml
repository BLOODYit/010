@{
    ViewBag.Title = "تقارير المقارنة لمؤشر في نطاق جغرافي";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container">
    <div class="row">
        <div class="col-xs-12">
            <h2>تقارير المقارنة لمؤشر في نطاق حغرافي</h2>
            <hr />         
            <div class="form-group">
                <label class = "control-label col-sm-2 col-xs-12">الحزمة</label>
                <div class="col-sm-10 col-xs-12">
                    @Html.DropDownList("BundleID", null, htmlAttributes: new { @class = "form-control", @id = "BundleID" })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-sm-2 col-xs-12">المؤشر</label>
                <div class="col-sm-10 col-xs-12">
                    <select id="IndicatorID" class="form-control" required>
                        <option value="">-- إختر المؤشر --</option>
                    </select>
                </div>
            </div>
            <div id="indicator"></div>
            <div id="report"></div>
        </div>
    </div>
</div>

@section  scripts{
    @Scripts.Render("~/scripts/charts")
    <script type="text/javascript">
        function getIndicator() {            
                $('#indicator').html('');
                var indicatorId = $('#IndicatorID').val();                
                if (indicatorId > 0) {
                    $.get("@Url.Action("GetIndicatorYears","Reports")/?indicatorId="+indicatorId, function (data, status) {
                        $('#indicator').html(data);
                    });
                }
        }

        function showReport() {
            $('#report').html('');
            var indicatorId = $('#IndicatorID').val();
            if (!(indicatorId > 0)) {
                alert('برجاء إختيار المؤشر');
                return;
            }

            if ($('#GeoAreaIds option').length <= 0) {
                alert('برجاء نطاق جغرافي واحد على الاقل');
                return;
            }
            var year = $('#year').val();                        
            if (!(year > 0)) {
                alert('برجاء السنة');
                return;
            }            
            var geoAreaIds = [];
            $("#GeoAreaIds option").each(function () {
                geoAreaIds.push($(this).val());
            });
            var q = "indicatorId=" + indicatorId + "&" + "&year=" + year;
            geoAreaIds.forEach(function (e, i) {
                q += "&geoAreaIds=" + e;
            });
            
            $.get("@Url.Action("GetGeo","Reports")/?"+q, function (data, status) {
                $('#report').html(data);
            });
        }
        $(function () {
            $('#BundleID').change(function (e) {
                var id = $(this).val();
                $('#IndicatorID option').remove();

                $('#IndicatorID').append("<option value=''>-- إختر المؤشر --</option>");
                $.get("@Url.Action("GetIndicatorsWithValues","Bundles")/" + id, function (data,status) {
                    data.data.forEach(function (e, i) {
                        $('#IndicatorID').append("<option value='"+e.ID+"'>"+e.Name+"</option>");
                    });
                });
            });
            $('#BundleID').change();

            $('#IndicatorID').change(function () {
                getIndicator();
            });

        });
    </script>
}