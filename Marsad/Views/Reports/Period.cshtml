@{
    ViewBag.Title = "تقارير المقارنة لمؤشر في مدة زمنية";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row">
        <div class="col-xs-12">
            <h2>تقارير المقارنة لمؤشر في مدة زمنية</h2>
            <hr />
            <form action="@Url.Action("Period")" method="get" id="GeoAreaTypeForm">
                <div class="form-group">
                    <label class="control-label col-sm-2 col-xs-12">النطاق الجغرافي</label>
                    <div class="col-sm-10 col-xs-12">
                        <select name="Type" class="form-control" id="GeoAreaType">
                            <option value="Region" @(ViewBag.Type == "Region" ? "selected" : "")>منطقة</option>
                            <option value="SubRegion" @(ViewBag.Type == "SubRegion" ? "selected" : "")>الحاضرة</option>
                            <option value="Governorate" @(ViewBag.Type == "Governorate" ? "selected" : "")>المحافظة</option>
                            <option value="Town" @(ViewBag.Type == "Town" ? "selected" : "")>البلدية</option>
                            <option value="City" @(ViewBag.Type == "City" ? "selected" : "")>المدينة</option>
                            <option value="District" @(ViewBag.Type == "District" ? "selected" : "")>الحي</option>
                        </select>
                    </div>
                </div>
            </form>
            <div class="form-group" id="IndicatorIDDiv">
                <label class="control-label col-sm-2 col-xs-12">@ViewBag.TypeName</label>
                <div class="col-sm-10 col-xs-12">
                    @Html.DropDownList("GeoAreaID", null, htmlAttributes: new { @class = "form-control", @id = "GeoAreaID" })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-sm-2 col-xs-12">الحزمة</label>
                <div class="col-sm-10 col-xs-12">
                    @Html.DropDownList("BundleID", null, htmlAttributes: new { @class = "form-control", @id = "BundleID" })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-sm-2 col-xs-12">المؤشر</label>
                <div class="col-sm-10 col-xs-12">
                    <select id="IndicatorID" class="form-control" required>
                        <option value="">-- إختر المؤشر --</option>
                    </select>
                </div>
            </div>

            <div id="indicator"></div>
            <div id="report"></div>            
        </div>
    </div>
</div>

@section  scripts{    
    @Scripts.Render("~/scripts/charts")
    <script type="text/javascript">

         function getIndicator() {
                $('#indicator').html('');
                var indicatorId = $('#IndicatorID').val();
                var geoAreaId = $('#GeoAreaID').val();
                if (indicatorId > 0 && geoAreaId > 0) {
                    $.get("@Url.Action("GetIndicatorEquations","Reports")/?indicatorId="+indicatorId+"&geoAreaId="+geoAreaId, function (data, status) {
                        $('#indicator').html(data);
                    });
                }
        }

        function showReport() {
            $('#report').html('');
            var indicatorId = $('#IndicatorID').val();
            var geoAreaId = $('#GeoAreaID').val();

            if (!(indicatorId > 0)) {
                alert('برجاء إختيار المؤشر');
                return;
            }
            if (!(geoAreaId > 0)) {
                alert('برجاء إختيار @ViewBag.TypeName');
                return;
            }
            var q = "indicatorId=" + indicatorId + "&geoAreaId=" + geoAreaId;
            $('.year').each(function () {
                q += "&year="+$(this).val();
            });
            $.get("@Url.Action("GetPeriod","Reports")/?"+q, function (data, status) {
                $('#report').html(data);
            });
        }
        $(function () {
            $('#BundleID').change(function (e) {
                var id = $(this).val();
                $('#IndicatorID option').remove();

                $('#IndicatorID').append("<option value=''>-- إختر المؤشر --</option>");
                $.get("@Url.Action("GetIndicatorsWithValues","Bundles")/" + id, function (data,status) {
                    data.data.forEach(function (e, i) {
                        $('#IndicatorID').append("<option value='"+e.ID+"'>"+e.Name+"</option>");
                    });
                });
            });
            $('#BundleID').change();

            $('#IndicatorID,#GeoAreaID').change(function () {
                getIndicator();
            });

            $('#GeoAreaType').change(function () {
                $('#GeoAreaTypeForm').submit();
            });

        });
    </script>
}