@model Marsad.Models.GeoAreaValue

@{
    ViewBag.Title = "تحديث العناصر والقيم";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container">
    <div class="row">
        <div class="col-xs-12">
            <h1>تحديث العناصر والقيم - @ViewBag.TypeName</h1>
            <hr />
            <form action="@Url.Action("GeoAreas")">
                <div class="form-group" id="IndicatorIDDiv">
                    @Html.LabelFor(model => model.GeoAreaID, null, htmlAttributes: new { @class = "control-label col-sm-2 col-xs-12" })
                    <div class="col-sm-10 col-xs-12">
                        @Html.DropDownList("GeoAreaID", null, htmlAttributes: new { @class = "form-control", @id = "IndicatorID" })
                        @Html.ValidationMessageFor(model => model.GeoAreaID, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group" id="">
                    <label class="control-label col-sm-2 col-xs-12">المعادلات</label>
                    <div class="col-sm-10 col-xs-12">
                        <select name="EquationID" id="EquationID" class="form-control">
                            @foreach (var eq in ViewBag.EquationID)
                            {
                                <option value="@eq.ID">@(eq.Indicator.Name + " - " + eq.Year.ToString())</option>
                            }
                        </select>
                        @Html.ValidationMessageFor(model => model.GeoAreaID, "", new { @class = "text-danger" })
                    </div>
                </div>

                <table class="table">
                    <tbody id="vals">
                    </tbody>
                </table>
                <button class="btn btn-success">تحديث</button>
            </form>
        </div>
    </div>
</div>

@section  scripts{
    <script>
        var values = [];
    @foreach (var eq in ViewBag.EquationID)
    {
        @String.Format("values[{0}]=[];", eq.ID);
        foreach(var ee in eq.EquationElements)
        {
            <text>values[@eq.ID].push({"id":@ee.Element.ID,"Name":"@ee.Element.Name"})</text>            
        }
    }
    $(document).ready(function () {
        $('#EquationID').change(function () {
        var val = $(this).val();
        vals = values[val];
            $('#vals').html("");
            for (var i = 0; i < vals.length; i++) {
                console.log(vals[i]);
                $('#vals').append(
                    '<tr>' +
                    '<td>'+vals[i].Name+'</td>' +
                    '<td><input name="elemets_"' + vals[i].id + ' class="form-control" /></td>' +
                    '<td>برجاء إدخال بيانات العنصر</td>'+
                    '</tr>'
                );
        }
        });

        $('#EquationID').change();
    });
    </script>
}