@model Marsad.Models.GeoAreaValue

@{
    ViewBag.Title = "تحديث العناصر والقيم";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container">
    <div class="row">
        <div class="col-xs-12">
            <h1>تحديث العناصر والقيم - @ViewBag.TypeName</h1>
            <hr />
            <form action="@Url.Action("GeoAreas")" method="get">
                <div class="form-group" id="IndicatorIDDiv">
                    @Html.LabelFor(model => model.GeoAreaID, null, htmlAttributes: new { @class = "control-label col-sm-2 col-xs-12" })
                    <div class="col-sm-10 col-xs-12">
                        @Html.DropDownList("GeoAreaID", null, htmlAttributes: new { @class = "form-control", @id = "GeoAreaID" })
                        @Html.ValidationMessageFor(model => model.GeoAreaID, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Equation.Indicator.BundleID, null, htmlAttributes: new { @class = "control-label col-sm-2 col-xs-12" })
                    <div class="col-sm-10 col-xs-12">
                        @Html.DropDownList("BundleID", null, htmlAttributes: new { @class = "form-control", @id = "BundleID" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Equation.IndicatorID, null, htmlAttributes: new { @class = "control-label col-sm-2 col-xs-12" })
                    <div class="col-sm-10 col-xs-12">
                        <select id="IndicatorID" name="IndicatorID" class="form-control" required>
                            <option value="">-- إختر المؤشر --</option>
                        </select>
                        @Html.ValidationMessageFor(model => model.Equation.IndicatorID, "", new { @class = "text-danger" })
                    </div>
                </div>
            </form>

            <div id="indicator"></div>
        </div>
    </div>
</div>

@section  scripts{
    <script type="text/javascript">
         function getIndicator() {
                $('#indicator').html('');
                var indicatorId = $('#IndicatorID').val();
                var geoAreaId = $('#GeoAreaID').val();
                if (indicatorId > 0 && geoAreaId > 0) {
                    $.get("@Url.Action("GetIndicatorEquations","Update")/?indicatorId="+indicatorId+"&geoAreaId="+geoAreaId, function (data, status) {
                        $('#indicator').html(data);
                    });
                }
        }

        $(function () {
            $('#BundleID').change(function (e) {
                var id = $(this).val();
                $('#IndicatorID option').remove();

                $('#IndicatorID').append("<option value=''>-- إختر المؤشر --</option>");
                $.get("@Url.Action("GetIndicatorsWithValues","Bundles")/" + id, function (data,status) {
                    data.data.forEach(function (e, i) {
                        $('#IndicatorID').append("<option value='"+e.ID+"'>"+e.Name+"</option>");
                    });
                });
            });
            $('#BundleID').change();

            $('#IndicatorID,#GeoAreaID').change(function () {
                getIndicator();
            });

           
        });
    </script>
}